<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    .chart div {
      font: 10px sans-serif;
      background-color: steelblue;
      text-align: right;
      padding: 3px;
      margin: 1px;
      color: white;
    }
  </style>
</head>
<body>
<div class="chart"></div>

<script>
  var canvas = d3.select("body")
    .append("canvas")
    .attr("width", 600)
    .attr("height", 200);

  var context = canvas.node().getContext("2d");

  var data = [1,2,3,4,5];

  // container for dummy elements:
  var faux = d3.select(document.createElement("custom"));

  // normal update exit selection with dummy elements:
  function update() {
    // modify data:
    manipulateData();


    var selection = faux.selectAll("circle")
      .data(data, function(d) { return d;});

    var exiting = selection.exit().size();
    var exit = selection.exit()
      .transition()
      .attr("r",0)
      .attr("cy", 70)
      .attr("fill","white")
      .duration(1200)
      .remove();

    var enter = selection.enter()
      .append("circle")
      .attr("cx", function(d,i) {
        return (i + exiting) * 20 + 20;
      })
      .attr("cy", 50)
      .attr("r", 0)
      .attr("fill",function(d) { return ["orange","steelblue","crimson","violet","yellow"][d%5]; });

    enter.transition()
      .attr("r", 8)
      .attr("cx", function(d,i) {
        return i * 20 + 20;
      })
      .duration(1200);

    selection
      .transition()
      .attr("cx", function(d,i) {
        return i * 20 + 20;
      })
      .duration(1200);

  }


  // update every 1.3 seconds
  setInterval(update,1300);


  // rendering function, called repeatedly:
  function render() {
    context.clearRect(0, 0, 600, 200);
    faux.selectAll("circle").each(function() {
      var sel = d3.select(this);
      context.beginPath();
      context.arc(sel.attr("cx"),sel.attr("cy"),sel.attr("r"),0,2*Math.PI);
      context.fillStyle = sel.attr("fill");
      context.fill();
      context.stroke();
    })
    window.requestAnimationFrame(render)
  }

  window.requestAnimationFrame(render)

  // to manipulate data:
  var index = 6; // to keep track of elements.
  function manipulateData() {
    data.forEach(function(d,i) {
      var r = Math.random();
      if (r < 0.5 && data.length > 1) {
        data.splice(i,1);
      }
      else {
        data.push(index++);
      }
    })
  }
</script>
</body>
</html>